# 器に咲く桜 — Sakura Projection

teamLab 風のインタラクティブアート体験。カメラでコップや茶碗を映すと、器の中に桜の花びらが浮かんでいるように見えるWebブラウザアプリケーションです。

## デモ

`index.html` をブラウザで開くだけで起動します。（ローカルファイルまたはWebサーバー経由）

> **注意**: カメラアクセスには HTTPS またはローカルホスト経由が必要です。
> ローカルで試す場合: `python -m http.server 8080` などのシンプルなHTTPサーバーを使用してください。

## 機能

| 機能 | 説明 |
|------|------|
| **カップ検出** | Sobel エッジ検出 + Hough 円変換でコップ・茶碗を自動認識 |
| **桜パーティクル** | WebGL / GLSL シェーダで 300 枚の花びらをリアルタイム描画 |
| **ゆっくり浮遊** | 花びらがゆっくりと揺れながら器の中を漂う |
| **散り演出** | コップを動かすと花びらがゆっくり散る |
| **再検出** | 散り終わると自動的にコップを再検出して投影を再開 |
| **手動配置** | 自動検出が難しい場合、クリック/タップで器の位置を手動指定可能 |

## 動作環境

- Windows / macOS / Linux のモダンブラウザ
- Google Chrome / Microsoft Edge / Firefox (最新版)
- WebGL 対応が必要（ほぼ全てのモダンブラウザで対応済み）
- カメラ（内蔵 / 外付け USB カメラ）

## ファイル構成

```
utsutsu-lab/
├── index.html          # メインページ
├── cup-detector.js     # カップ検出（エッジ検出 + Hough 円変換）
├── cherry-renderer.js  # WebGL 桜パーティクルレンダラー（GLSL シェーダ）
└── main.js             # アプリケーション制御・ステートマシン
```

## 技術仕様

### カップ検出アルゴリズム
- フレームを 80×60 にダウンスケールして高速処理
- Sobel フィルタでエッジ検出
- 簡略化した Hough 円変換で円形領域を検出
- EMA（指数移動平均）でスムージング
- 6フレームごとに実行（60fps 時は 10fps 相当）

### 桜シェーダ（GLSL ES 1.0）
- **頂点シェーダ**: 時間ベースのフローティングアニメーション + 散り物理演算
- **フラグメントシェーダ**: 5 枚花びらの SDF（符号付き距離関数）で桜形状を描画
- ポイントスプライト（`gl.POINTS`）で 300 パーティクルを一括レンダリング
- `additive` でなく `src_alpha` ブレンドで半透明のはかない表現

## 検出のコツ

- コップの縁（リム）が背景と明確に区別できると検出精度が上がります
- 単色の背景（白い壁など）が最適
- 明るい環境が推奨
- 検出できない場合はクリックで手動配置してください

## Closes

Issue #1
